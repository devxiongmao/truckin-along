<div class="page-header">
  <h1 class="page-title">Edit Shipment Status Preference</h1>
  <%= link_to 'Back', admin_index_path, class: 'button secondary-button' %>
</div>

<h1>Shipment Status Preferences</h1>

<% ShipmentActionPreference::ACTIONS.each do |action| %>
<% preference = current_company.shipment_action_preferences.find_by(action: action) %>

<div class="preference-setting">
  <p>When a shipment is <%= action.humanize.downcase %>, set status to:</p>

  <%= form_tag shipment_action_preferences_path, method: :post do %>
  <%= hidden_field_tag :action_name, action %>
  <%= select_tag :status, 
                     options_for_select(ShipmentActionPreference::STATUSES, preference&.status),
                     include_blank: "-- Select Status --" %>
  <%= submit_tag "Save" %>
  <% end %>
</div>
<% end %>


<%= form_with(model: preference, local: true, class: 'styled-form') do |form| %>
<% if preference.errors.any? %>
<div class="error-messages">
  <h2><%= pluralize(@preference.errors.count, 'error') %> prohibited this preference from being saved:</h2>
  <ul>
    <% preference.errors.full_messages.each do |message| %>
    <li><%= message %></li>
    <% end %>
  </ul>
</div>
<% end %>

<%= form.hidden_field :company_id, value: current_user.company_id %>

<div class="form-group">
  <%= form.label :name, class: 'form-label' %>
  <%= form.text_field :name, class: 'form-input' %>
</div>

<div class="form-group">
  <%= form.label :locked_for_customers, 'Lock for Customers?', class: 'form-label' %>
  <%= form.check_box :locked_for_customers, class: 'form-checkbox' %>
  <small class="help-text">If checked, customers will not be able to update shipments with this status.</small>
</div>

<div class="form-group">
  <%= form.label :closed, 'Mark as Closed?', class: 'form-label' %>
  <%= form.check_box :closed, class: 'form-checkbox' %>
  <small class="help-text">If checked, this shipment will be considered closed and no further updates will be allowed.</small>
</div>

<div class="actions">
  <%= form.submit 'Save Shipment Status', class: 'button primary-button' %>
</div>
<% end %>